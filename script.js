const $=(s,ctx=document)=>ctx.querySelector(s),BRL=new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'});
let PRODUCTS=[];const key='loren.cart.v2';
async function init(){PRODUCTS=await (await fetch('products.json')).json();render(PRODUCTS);updateCart();document.getElementById('year').textContent=new Date().getFullYear();document.getElementById('wa').href='https://wa.me/'+window.__WHATS__;}
function render(list){const g=document.getElementById('grid');g.innerHTML='';list.forEach(p=>{const d=document.createElement('div');d.className='card';d.innerHTML=`<img src="${p.image}" style="width:100%;height:180px;object-fit:cover;border-radius:8px"><h4>${p.name}</h4><div>${BRL.format(p.price)}</div><button class="btn add" data-id="${p.id}">Adicionar</button>`;g.appendChild(d)});document.querySelectorAll('.add').forEach(b=>b.addEventListener('click',e=>add(e.target.dataset.id)))}function read(){try{return JSON.parse(localStorage.getItem(key))||[]}catch{return []}}function write(v){localStorage.setItem(key,JSON.stringify(v));updateCart()}function add(id){const c=read();const it=c.find(x=>x.id==id);if(it)it.qty++;else c.push({id,qty:1});write(c);openCart()}function updateCart(){const c=read();let sub=0,count=0;const wrap=document.getElementById('items');wrap.innerHTML='';c.forEach(i=>{const p=PRODUCTS.find(x=>x.id==i.id)||{};count+=i.qty;sub+=p.price*i.qty;const el=document.createElement('div');el.style.display='flex';el.style.justifyContent='space-between';el.style.margin='8px 0';el.innerHTML=`<div><strong>${p.name}</strong><div>${BRL.format(p.price)} Ã— ${i.qty}</div></div><div><button class="rm" data-id="${i.id}">Remover</button></div>`;wrap.appendChild(el)});document.getElementById('count').textContent=count;document.getElementById('sub').textContent=BRL.format(sub);document.querySelectorAll('.rm').forEach(b=>b.addEventListener('click',e=>{const id=e.target.dataset.id;write(read().filter(x=>x.id!=id))}))}function openCart(){document.getElementById('cart').classList.add('open')}function closeCart(){document.getElementById('cart').classList.remove('open')}document.getElementById('btnCart').addEventListener('click',openCart);document.getElementById('close').addEventListener('click',closeCart);init();